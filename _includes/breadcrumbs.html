{%- comment -%}
  Generates visible breadcrumb navigation and BreadcrumbList JSON-LD
  structured data for:
    - Blog posts (Blog > Year > Month > Post title)
    - Notes (Notes > Category > Title)
    - Teaching (Teaching > Course title)
    - Talks (Talks > Talk title)
    - Tag pages (Tags > Tag name)
    - Pages under /travels/ (path-based breadcrumbs)
  https://developers.google.com/search/docs/appearance/structured-data/breadcrumb
{%- endcomment -%}

{%- comment -%}--- BLOG POST BREADCRUMBS ---{%- endcomment -%}
{%- if page.layout == "post" and page.date -%}
{%- assign post_year = page.date | date: "%Y" -%}
{%- assign post_month_num = page.date | date: "%m" -%}
{%- assign post_month_name = page.date | date: "%B" -%}
<nav aria-label="Breadcrumb" class="breadcrumbs">
  <ol>
    <li><a href="/all_posts">Blog</a></li>
    <li><a href="/{{ post_year }}/">{{ post_year }}</a></li>
    <li><a href="/{{ post_year }}/{{ post_month_num }}/">{{ post_month_name }}</a></li>
    <li aria-current="page">{{ page.title }}</li>
  </ol>
</nav>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Blog",
      "item": "{{ site.url }}/all_posts"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ post_year }}",
      "item": "{{ site.url }}/{{ post_year }}/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ post_month_name }}",
      "item": "{{ site.url }}/{{ post_year }}/{{ post_month_num }}/"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "{{ page.title }}"
    }
  ]
}
</script>

{%- comment -%}--- NOTES BREADCRUMBS ---{%- endcomment -%}
{%- elsif page.url contains '/notes/' and page.url != '/notes/' -%}
{%- if page.note_category -%}
{%- assign note_cat = page.note_category -%}
{%- assign note_cat_slug = note_cat | slugify -%}
<nav aria-label="Breadcrumb" class="breadcrumbs">
  <ol>
    <li><a href="/notes">Notes</a></li>
    <li><a href="/notes#{{ note_cat_slug }}">{{ note_cat }}</a></li>
    <li aria-current="page">{{ page.title }}</li>
  </ol>
</nav>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Notes",
      "item": "{{ site.url }}/notes"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ note_cat }}",
      "item": "{{ site.url }}/notes#{{ note_cat_slug }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ page.title }}"
    }
  ]
}
</script>
{%- endif -%}

{%- comment -%}--- TEACHING BREADCRUMBS ---{%- endcomment -%}
{%- elsif page.url contains '/teaching/' and page.url != '/teaching/' -%}
{%- assign teach_title = page.title | default: page.url | split: '/' | last -%}
<nav aria-label="Breadcrumb" class="breadcrumbs">
  <ol>
    <li><a href="/teaching">Teaching</a></li>
    <li aria-current="page">{{ teach_title }}</li>
  </ol>
</nav>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Teaching",
      "item": "{{ site.url }}/teaching"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ teach_title }}"
    }
  ]
}
</script>

{%- comment -%}--- TALKS BREADCRUMBS ---{%- endcomment -%}
{%- elsif page.url contains '/talks/' and page.url != '/talks/' -%}
{%- assign talk_clean_url = page.url | replace: '.html', '' | replace: '/index.html', '' -%}
{%- assign talk_entry = nil -%}
{%- for t in site.data.talks -%}
  {%- if t.url == talk_clean_url -%}
    {%- assign talk_entry = t -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}
{%- assign talk_title = talk_entry.title | default: page.title | default: page.url | split: '/' | last -%}
<nav aria-label="Breadcrumb" class="breadcrumbs">
  <ol>
    <li><a href="/talks">Talks</a></li>
    <li aria-current="page">{{ talk_title }}</li>
  </ol>
</nav>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Talks",
      "item": "{{ site.url }}/talks"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ talk_title }}"
    }
  ]
}
</script>

{%- comment -%}--- TAG PAGE BREADCRUMBS ---{%- endcomment -%}
{%- elsif page.layout == "tag" -%}
<nav aria-label="Breadcrumb" class="breadcrumbs">
  <ol>
    <li><a href="/tags">Tags</a></li>
    <li aria-current="page">{{ page.tag }}</li>
  </ol>
</nav>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Tags",
      "item": "{{ site.url }}/tags"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ page.tag }}"
    }
  ]
}
</script>

{%- comment -%}--- TRAVELS BREADCRUMBS ---{%- endcomment -%}
{%- elsif page.url contains '/travels/' -%}
{%- assign clean_url = page.url | replace: '/index.html', '' | replace: '.html', '' -%}
{%- assign url_parts = clean_url | split: '/' -%}
{%- assign part_count = 0 -%}
{%- for segment in url_parts -%}
  {%- if segment != "" -%}{%- assign part_count = part_count | plus: 1 -%}{%- endif -%}
{%- endfor -%}
{%- if part_count >= 2 %}
<nav aria-label="Breadcrumb" class="breadcrumbs">
  <ol>
    {%- assign crumb_path = "" -%}
    {%- assign position = 0 -%}
    {%- for segment in url_parts -%}
      {%- if segment != "" -%}
        {%- assign position = position | plus: 1 -%}
        {%- assign crumb_path = crumb_path | append: "/" | append: segment -%}
        {%- assign crumb_name = site.data.breadcrumb_names[segment] | default: segment -%}
        {%- if position == part_count %}
    <li aria-current="page">{{ crumb_name }}</li>
        {%- else %}
    <li><a href="{{ crumb_path }}">{{ crumb_name }}</a></li>
        {%- endif -%}
      {%- endif -%}
    {%- endfor %}
  </ol>
</nav>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {%- assign crumb_path = "" -%}
    {%- assign position = 0 -%}
    {%- for segment in url_parts -%}
      {%- if segment != "" -%}
        {%- assign position = position | plus: 1 -%}
        {%- assign crumb_path = crumb_path | append: "/" | append: segment -%}
        {%- assign crumb_name = site.data.breadcrumb_names[segment] | default: segment -%}
        {%- if position == part_count %}
    {
      "@type": "ListItem",
      "position": {{ position }},
      "name": "{{ crumb_name }}"
    }
        {%- else %}
    {
      "@type": "ListItem",
      "position": {{ position }},
      "name": "{{ crumb_name }}",
      "item": "{{ site.url }}{{ crumb_path }}"
    },
        {%- endif -%}
      {%- endif -%}
    {%- endfor %}
  ]
}
</script>
{%- endif -%}
{%- endif -%}
